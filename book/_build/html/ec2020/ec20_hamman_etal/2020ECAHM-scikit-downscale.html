
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scikit-downscale: an open source Python package for scalable climate downscaling &#8212; EarthCube GeoCODES Exploration</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3D volume rendering of geophysical data using the yt platform" href="../ec20_havlin_etal/notebook/ec20_havlin_etal.html" />
    <link rel="prev" title="CMIP6 without the interpolation: Grid-native analysis with Pangeo in the cloud" href="../ec20_busecke_etal/busecke_abernathey_earthcube2020.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube GeoCODES Exploration</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Exploring GeoCODES
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content.html">
   Content in Jupyter Book
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../markdown.html">
     Markdown Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../notebooks.html">
     Content with notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analysis.html">
     Data Unit Testing, ranking, clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../partfile.html">
   Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../notebooks/gleaner_clustering.html">
     SciKit K-means Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../notebooks/gleaner_gensim.html">
     Gensim
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../notebooks/gleaner_txtai.html">
     Gleaner &amp; txtai
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../notebooks/ECO_GraphAnalytics.html">
     EarthCube Graph Analytics Exploration
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   EC2020 examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_soliman_etal/ks-preprocess-dem.html">
     Processing digital elevation data for deep learning models using Keras Spatial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_peckham_etal/BALTO_GUI_v2.html">
     BALTO Graphical User Interface (A Prototype)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_busecke_etal/busecke_abernathey_earthcube2020.html">
     CMIP6 without the interpolation: Grid-native analysis with Pangeo in the cloud
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Scikit-downscale: an open source Python package for scalable climate downscaling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_havlin_etal/notebook/ec20_havlin_etal.html">
     3D volume rendering of geophysical data using the yt platform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_banihirwe_etal/intake-pangeo-catalog.html">
     Intake / Pangeo Catalog: Making It Easier To Consume Earth’s Climate and Weather Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_tucker_etal/EC2020_argovis_python_api.html">
     Python API to argovis.colorado.edu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_tucker_etal/argovis_bgc_python_api.html">
     1. Get a BGC profile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_abernathey_etal/cloud_storage.html">
     Big Arrays, Fast: Profiling Cloud Storage Read Throughput
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_augspurger_etal/multicloud.html">
     Multi-Cloud Workflow with Pangeo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_tauxe_etal/PmagPy_online_Earthcube_conference.html">
     PmagPy Online: Jupyter Notebooks, the PmagPy Software Package and the Magnetics Information Consortium (MagIC) Database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_marini_etal/ecgs.html">
     Semantic Annotation of Data using JSON Linked Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec20_jones_etal/xarrayutils_xlayers.html">
     Vertical regridding and remapping of CMIP6 ocean data in the cloud
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/ec2020/ec20_hamman_etal/2020ECAHM-scikit-downscale.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/fils/EarthCubeGraphAnalytics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/fils/EarthCubeGraphAnalytics/issues/new?title=Issue%20on%20page%20%2Fec2020/ec20_hamman_etal/2020ECAHM-scikit-downscale.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/fils/EarthCubeGraphAnalytics/master?urlpath=lab/tree/book/ec2020/ec20_hamman_etal/2020ECAHM-scikit-downscale.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="your-hub-url/hub/user-redirect/git-pull?repo=https://github.com/fils/EarthCubeGraphAnalytics&urlpath=lab/tree/EarthCubeGraphAnalytics/book/ec2020/ec20_hamman_etal/2020ECAHM-scikit-downscale.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/fils/EarthCubeGraphAnalytics/blob/master/book/ec2020/ec20_hamman_etal/2020ECAHM-scikit-downscale.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scikit-downscale">
   2. Scikit-downscale
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pointwise-models">
     2.1 Pointwise Models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#models-as-cattle-not-pets">
     2.2 Models as cattle, not pets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tailor-made-methods-in-a-common-framework">
     2.3 Tailor-made methods in a common framework
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#z-score-method">
       2.3.1 Z-Score Method
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-the-zscoreregressor-class">
       2.3.2 Building the ZScoreRegressor Class
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#automatic-parallelization">
     2.4 Automatic Parallelization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spatial-models">
     2.2 Spatial Models
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   3. Discussion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benchmark-applications">
     3.1 Benchmark Applications
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#call-for-participation">
     3.2 Call for Participation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license">
   License
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="scikit-downscale-an-open-source-python-package-for-scalable-climate-downscaling">
<h1>Scikit-downscale: an open source Python package for scalable climate downscaling<a class="headerlink" href="#scikit-downscale-an-open-source-python-package-for-scalable-climate-downscaling" title="Permalink to this headline">¶</a></h1>
<p>Joseph Hamman (<a class="reference external" href="mailto:jhamman&#37;&#52;&#48;ucar&#46;edu">jhamman<span>&#64;</span>ucar<span>&#46;</span>edu</a>) and Julia Kent (<a class="reference external" href="mailto:jkent&#37;&#52;&#48;ucar&#46;edu">jkent<span>&#64;</span>ucar<span>&#46;</span>edu</a>)</p>
<p>NCAR, Boulder, CO, USA</p>
<hr class="docutils" />
<p>This notebook was developed for the <a class="reference external" href="https://www.earthcube.org/EC2020">2020 EarthCube All Hands Meeting</a>. The development of Scikit-downscale done in conjunction with the development of the <a class="reference external" href="http://pangeo.io/">Pangeo Project</a> and was supported by the following awards:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1740633">NSF-GEO-AGS 1928374: EarthCube Data Capabilities: Collaborative Proposal: Jupyter meets the Earth: Enabling discovery in geoscience through interactive computing at scale</a></p></li>
<li><p><a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1937136">NSF-OIA 1937136: Convergence Accelerator Phase I (RAISE): Knowledge Open Network Queries for Research (KONQUER)</a></p></li>
</ul>
<p>ECAHM 2020 ID: 143</p>
<hr class="docutils" />
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Climate data from Earth System Models (ESMs) are increasingly being used to study the impacts of climate change on a broad range of biogeophysical systems (forest fire, flood, fisheries, etc.) and human systems (water resources, power grids, etc.). Before this data can be used to study many of these systems, post-processing steps commonly referred to as bias correction and statistical downscaling must be performed. “Bias correction” is used to correct persistent biases in climate model output and “statistical downscaling” is used to increase the spatiotemporal resolution of the model output (i.e. from 1 deg to 1/16th deg grid boxes). For our purposes, we’ll refer to both parts as “downscaling”.</p>
<p>In the past few decades, the applications community has developed a plethora of downscaling methods. Many of these methods are ad-hoc collections of processing routines while others target very specific applications. The proliferation of downscaling methods has left the climate applications community with an overwhelming body of research to sort through without much in the form of synthesis guilding method selection or applicability.</p>
<p>Motivated by the pressing socio-environmental challenges of climate change – and with the learnings from previous downscaling efforts (e.g. Gutmann et al. 2014, Lanzante et al. 2018) in mind – we have begun working on a community-centered open framework for climate downscaling: <a class="reference external" href="https://scikit-downscale.readthedocs.io/en/latest/">scikit-downscale</a>. We believe that the community will benefit from the presence of a well-designed open source downscaling toolbox with standard interfaces alongside a repository of benchmark data to test and evaluate new and existing downscaling methods.</p>
<p>In this notebook, we provide an overview of the scikit-downscale project, detailing how it can be used to downscale a range of surface climate variables such as surface air temperature and precipitation. We also highlight how scikit-downscale framework is being used to compare exisiting methods and how it can be extended to support the development of new downscaling methods.</p>
</div>
<div class="section" id="scikit-downscale">
<h2>2. Scikit-downscale<a class="headerlink" href="#scikit-downscale" title="Permalink to this headline">¶</a></h2>
<p>Scikit-downscale is a new open source Python project. Within Scikit-downscale, we are been curating a collection of new and existing downscaling methods within a common framework. Key features of Scikit-downscale are:</p>
<ul class="simple">
<li><p>A high-level interface modeled after the popular <code class="docutils literal notranslate"><span class="pre">fit</span></code> / <code class="docutils literal notranslate"><span class="pre">predict</span></code> pattern found in many machine learning packages (<a class="reference external" href="https://scikit-learn.org/stable/index.html">Scikit-learn</a>, <a class="reference external" href="https://www.tensorflow.org/guide/keras">Tensorflow</a>, etc.),</p></li>
<li><p>Uses <a class="reference external" href="http://xarray.pydata.org/en/stable/">Xarray</a> and <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> data structures and utilities for handling of labeled datasets,</p></li>
<li><p>Utilities for automatic parallelization of pointwisde downscaling models,</p></li>
<li><p>Common interface for pointwise and spatial (or global) downscaling models, and</p></li>
<li><p>Extensible, allowing the creation of new downscaling methods through composition.</p></li>
</ul>
<p>Scikit-downscale’s source code is available on <a class="reference external" href="https://github.com/jhamman/scikit-downscale">GitHub</a>.</p>
<div class="section" id="pointwise-models">
<h3>2.1 Pointwise Models<a class="headerlink" href="#pointwise-models" title="Permalink to this headline">¶</a></h3>
<p>We define pointwise methods as those that only use local information during the downscaling process. They can be often represented as a general linear model and fit independently across each point in the study domain. Examples of existing pointwise methods are:</p>
<ul class="simple">
<li><p>BCSD_[Temperature, Precipitation]: Wood et al. (2004)</p></li>
<li><p>ARRM: Stoner et al. (2012)</p></li>
<li><p>(Hybrid) Delta Method (e.g. Hamlet et al. (2010)</p></li>
<li><p><a class="reference external" href="https://github.com/NCAR/GARD">GARD</a>: Gutmann et al (in prep).</p></li>
</ul>
<p>Because pointwise methods can be written as a stand-alone linear model, Scikit-downscale implements these models as a Scikit-learn <a class="reference external" href="https://scikit-learn.org/stable/modules/linear_model.html">LinearModel</a> or <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html">Pipeline</a>. By building directly on Scikit-learn, we inherit a well defined model API and the ability to interoperate with a robust ecosystem utilities for model evaluation and optimization (e.g. grid-search). Perhaps more importantly, this structure also allows us to compare methods at a high-level of granularity (single spatial point) before deploying them on large domain problems.</p>
<hr class="docutils" />
<p><em><strong>Begin interactive demo</strong></em></p>
<hr class="docutils" />
<p>From here forward in this notebook, we’ll jump back and forth between Python and text cells to describe how scikit-downscale works.</p>
<p>This first cell just imports some libraries and get’s things setup for our analysis to come.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>  <span class="c1"># sklearn</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_sample_data</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;darkgrid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve imported a few libraries, let’s open a sample dataset from a single point in North America. We’ll use this data to explore Scikit-downscale and its existing functionality. You’ll notice there are two groups of data, <code class="docutils literal notranslate"><span class="pre">training</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code>. The <code class="docutils literal notranslate"><span class="pre">training</span></code> data is meant to represent data from a typical climate model and the <code class="docutils literal notranslate"><span class="pre">targets</span></code> data is meant to represent our “observations”. For the purpose of this demonstration, we’ve choosen training data sampled from a regional climate model (WRF) run at 50km resolution over North America. The observations are sampled from the nearest 1/16th grid cell in Livneh et al, 2013.</p>
<p>We have choosen to use the <code class="docutils literal notranslate"><span class="pre">tmax</span></code> variable (daily maximum surface air temperature) for demonstration purposes. With a small amount of effort, an interested reader could swap <code class="docutils literal notranslate"><span class="pre">tmax</span></code> for <code class="docutils literal notranslate"><span class="pre">pcp</span></code> and test these methods on precipitation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load sample data</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">get_sample_data</span><span class="p">(</span><span class="s1">&#39;training&#39;</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">get_sample_data</span><span class="p">(</span><span class="s1">&#39;targets&#39;</span><span class="p">)</span>

<span class="c1"># print a table of the training/targets data</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="n">training</span><span class="p">,</span> <span class="s1">&#39;targets&#39;</span><span class="p">:</span> <span class="n">targets</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># make a plot of the temperature and precipitation data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">time_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1990-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1990-12-31&#39;</span><span class="p">)</span>

<span class="c1"># plot-temperature</span>
<span class="n">training</span><span class="p">[</span><span class="n">time_slice</span><span class="p">][</span><span class="s1">&#39;tmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">)</span>
<span class="n">targets</span><span class="p">[</span><span class="n">time_slice</span><span class="p">][</span><span class="s1">&#39;tmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;targets&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature [C]&#39;</span><span class="p">)</span>

<span class="c1"># plot-precipitation</span>
<span class="n">training</span><span class="p">[</span><span class="n">time_slice</span><span class="p">][</span><span class="s1">&#39;pcp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">targets</span><span class="p">[</span><span class="n">time_slice</span><span class="p">][</span><span class="s1">&#39;pcp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precipitation [mm/day]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">training</th>
      <th colspan="2" halign="left">targets</th>
    </tr>
    <tr>
      <th></th>
      <th>tmax</th>
      <th>pcp</th>
      <th>tmax</th>
      <th>pcp</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1950-01-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.22</td>
      <td>5.608394</td>
    </tr>
    <tr>
      <th>1950-01-02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-4.54</td>
      <td>2.919726</td>
    </tr>
    <tr>
      <th>1950-01-03</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-7.87</td>
      <td>3.066762</td>
    </tr>
    <tr>
      <th>1950-01-04</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-5.08</td>
      <td>4.684164</td>
    </tr>
    <tr>
      <th>1950-01-05</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.79</td>
      <td>4.295568</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2015-11-26</th>
      <td>7.657013</td>
      <td>0.000000e+00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-11-27</th>
      <td>7.687256</td>
      <td>0.000000e+00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-11-28</th>
      <td>10.480835</td>
      <td>0.000000e+00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-11-29</th>
      <td>11.728516</td>
      <td>0.000000e+00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-11-30</th>
      <td>10.285431</td>
      <td>3.152419e-13</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>24075 rows × 4 columns</p>
</div></div><img alt="../../_images/2020ECAHM-scikit-downscale_7_1.png" src="../../_images/2020ECAHM-scikit-downscale_7_1.png" />
</div>
</div>
</div>
<div class="section" id="models-as-cattle-not-pets">
<h3>2.2 Models as cattle, not pets<a class="headerlink" href="#models-as-cattle-not-pets" title="Permalink to this headline">¶</a></h3>
<p>As we mentioned above, Scikit-downscale utilizes a similiar API to that of Scikit-learn for its pointwise models. This means we can build collections of models that may be quite different internally, but operate the same at the API level. Importantly, this means that all downscaling methods have two common API methods: <code class="docutils literal notranslate"><span class="pre">fit</span></code>, which trains the model given <em>training</em> and <em>targets</em> data, and <code class="docutils literal notranslate"><span class="pre">predict</span></code> which uses the fit model to perform the downscaling opperation. This is perhaps the most important feature of Scikit-downscale, the ability to test and compare arbitrary combinations of models under a common interface. This allows us to try many combinations of models and parameters, choosing only the best combinations. The following pseudo-code block describe the workflow common to all scikit-downscale models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skdownscale.pointwise_models</span> <span class="kn">import</span> <span class="n">MyModel</span>

<span class="o">...</span>
<span class="c1"># load and pre-process input data (X and y)</span>
<span class="o">...</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_predict</span><span class="p">)</span>

<span class="o">...</span>
<span class="c1"># evaluate and/or save predictions</span>
<span class="o">...</span>


</pre></div>
</div>
<p>In the cell below, we’ll create nine different downscaling models, some from Scikit-downscale and some from Scikit-learn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="kn">from</span> <span class="nn">skdownscale.pointwise_models</span> <span class="kn">import</span> <span class="n">PureAnalog</span><span class="p">,</span> <span class="n">AnalogRegression</span>
<span class="kn">from</span> <span class="nn">skdownscale.pointwise_models</span> <span class="kn">import</span> <span class="n">BcsdTemperature</span><span class="p">,</span> <span class="n">BcsdPrecipitation</span>


<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;GARD: PureAnalog-best-1&#39;</span><span class="p">:</span> <span class="n">PureAnalog</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;best_analog&#39;</span><span class="p">,</span> <span class="n">n_analogs</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;GARD: PureAnalog-sample-10&#39;</span><span class="p">:</span> <span class="n">PureAnalog</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;sample_analogs&#39;</span><span class="p">,</span> <span class="n">n_analogs</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;GARD: PureAnalog-weight-10&#39;</span><span class="p">:</span> <span class="n">PureAnalog</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;weight_analogs&#39;</span><span class="p">,</span> <span class="n">n_analogs</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;GARD: PureAnalog-weight-100&#39;</span><span class="p">:</span> <span class="n">PureAnalog</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;weight_analogs&#39;</span><span class="p">,</span> <span class="n">n_analogs</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;GARD: PureAnalog-mean-10&#39;</span><span class="p">:</span> <span class="n">PureAnalog</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mean_analogs&#39;</span><span class="p">,</span> <span class="n">n_analogs</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;GARD: AnalogRegression-100&#39;</span><span class="p">:</span> <span class="n">AnalogRegression</span><span class="p">(</span><span class="n">n_analogs</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;GARD: LinearRegression&#39;</span><span class="p">:</span> <span class="n">LinearRegression</span><span class="p">(),</span>
    <span class="s1">&#39;BCSD: BcsdTemperature&#39;</span><span class="p">:</span> <span class="n">BcsdTemperature</span><span class="p">(</span><span class="n">return_anoms</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="s1">&#39;Sklearn: RandomForestRegressor&#39;</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">train_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1980-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1989-12-31&#39;</span><span class="p">)</span>
<span class="n">predict_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1990-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1999-12-31&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve created a collection of models, we want to train the models on the same input data. We do this by looping through our dictionary of models and calling the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract training / prediction data</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">training</span><span class="p">[[</span><span class="s1">&#39;tmax&#39;</span><span class="p">]][</span><span class="n">train_slice</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[[</span><span class="s1">&#39;tmax&#39;</span><span class="p">]][</span><span class="n">train_slice</span><span class="p">]</span>
<span class="n">X_predict</span> <span class="o">=</span> <span class="n">training</span><span class="p">[[</span><span class="s1">&#39;tmax&#39;</span><span class="p">]][</span><span class="n">predict_slice</span><span class="p">]</span>

<span class="c1"># Fit all models</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Just like that, we fit nine downscaling models. Now we want to use those models to downscale/bias-correct our data. For the sake of easy comparison, we’ll use a different part of the training data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store predicted results in this dataframe</span>
<span class="n">predict_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">X_predict</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">predict_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_predict</span><span class="p">)</span>

<span class="c1"># show a table of the predicted data</span>
<span class="n">display</span><span class="p">(</span><span class="n">predict_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GARD: PureAnalog-best-1</th>
      <th>GARD: PureAnalog-sample-10</th>
      <th>GARD: PureAnalog-weight-10</th>
      <th>GARD: PureAnalog-weight-100</th>
      <th>GARD: PureAnalog-mean-10</th>
      <th>GARD: AnalogRegression-100</th>
      <th>GARD: LinearRegression</th>
      <th>BCSD: BcsdTemperature</th>
      <th>Sklearn: RandomForestRegressor</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1990-01-01</th>
      <td>4.50</td>
      <td>5.67</td>
      <td>5.375299</td>
      <td>5.697786</td>
      <td>5.895</td>
      <td>5.931445</td>
      <td>5.781472</td>
      <td>4.528703</td>
      <td>5.2024</td>
    </tr>
    <tr>
      <th>1990-01-02</th>
      <td>6.13</td>
      <td>3.55</td>
      <td>3.543398</td>
      <td>3.264698</td>
      <td>2.561</td>
      <td>2.515919</td>
      <td>2.524322</td>
      <td>-1.584749</td>
      <td>4.6935</td>
    </tr>
    <tr>
      <th>1990-01-03</th>
      <td>5.46</td>
      <td>3.04</td>
      <td>4.963575</td>
      <td>4.933534</td>
      <td>4.692</td>
      <td>4.862730</td>
      <td>4.944167</td>
      <td>2.848937</td>
      <td>4.6736</td>
    </tr>
    <tr>
      <th>1990-01-04</th>
      <td>8.57</td>
      <td>5.90</td>
      <td>8.369125</td>
      <td>8.239455</td>
      <td>7.340</td>
      <td>7.255379</td>
      <td>7.107427</td>
      <td>6.687826</td>
      <td>8.4134</td>
    </tr>
    <tr>
      <th>1990-01-05</th>
      <td>5.67</td>
      <td>7.03</td>
      <td>7.424970</td>
      <td>7.583703</td>
      <td>7.705</td>
      <td>7.711861</td>
      <td>7.878299</td>
      <td>8.296425</td>
      <td>6.5789</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, let’s do some sample analysis on our predicted data. First, we’ll look at a timeseries of all the downscaled timeseries for the first year of the prediction period. In the figure below, the <code class="docutils literal notranslate"><span class="pre">target</span></code> (truth) data is shown in black, the original (pre-correction) data is shown in grey, and each of the downscaled data timeseries is shown in a different color.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">targets</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">][</span><span class="n">time_slice</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_predict</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">][</span><span class="n">time_slice</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">predict_df</span><span class="p">[</span><span class="n">time_slice</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature [C]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2020ECAHM-scikit-downscale_15_0.png" src="../../_images/2020ECAHM-scikit-downscale_15_0.png" />
</div>
</div>
<p>Of course, its difficult to tell which of the nine downscaling methods performed best from our plot above. We may want to evaluate our predictions using a standard statistical score, such as <span class="math notranslate nohighlight">\(r^2\)</span>. Those results are easily computed below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate r2</span>
<span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">predict_df</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">tmax</span><span class="p">[</span><span class="n">predict_slice</span><span class="p">])</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;r2_score&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>r2_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GARD: PureAnalog-best-1</th>
      <td>0.820281</td>
    </tr>
    <tr>
      <th>GARD: PureAnalog-sample-10</th>
      <td>0.820977</td>
    </tr>
    <tr>
      <th>BCSD: BcsdTemperature</th>
      <td>0.858258</td>
    </tr>
    <tr>
      <th>Sklearn: RandomForestRegressor</th>
      <td>0.864160</td>
    </tr>
    <tr>
      <th>GARD: PureAnalog-weight-10</th>
      <td>0.881287</td>
    </tr>
    <tr>
      <th>GARD: PureAnalog-weight-100</th>
      <td>0.892049</td>
    </tr>
    <tr>
      <th>GARD: PureAnalog-mean-10</th>
      <td>0.899297</td>
    </tr>
    <tr>
      <th>GARD: AnalogRegression-100</th>
      <td>0.906217</td>
    </tr>
    <tr>
      <th>GARD: LinearRegression</th>
      <td>0.906316</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>All of our downscaling methods seem to be doing fairly well. The timeseries and statistics above shows that all our methods are producing generally resonable results. However, we are often interested in how our models do at predicting extreme events. We can quickly look into those aspects of our results using the <code class="docutils literal notranslate"><span class="pre">qq</span></code> plots below. There you’ll see that the models diverge in some interesting ways. For example, while the <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> method has the highest <span class="math notranslate nohighlight">\(r^2\)</span> score, it seems to have trouble capturing extreme heat events. Whereas many of the analog methods, as well as the <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>, perform much better on the tails of the distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">prob_plots</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">prob_plots</span><span class="p">(</span><span class="n">X_predict</span><span class="p">,</span> <span class="n">targets</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">],</span> <span class="n">predict_df</span><span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2020ECAHM-scikit-downscale_19_0.png" src="../../_images/2020ECAHM-scikit-downscale_19_0.png" />
</div>
</div>
<p>In this section, we’ve shown how easy it is to fit, predict, and evaluate scikit-downscale models. The seamless interoperability of these models clearly facilitates a workflow that enables a deeper level of model evaluation that is otherwise possible in the downscaling world.</p>
</div>
<div class="section" id="tailor-made-methods-in-a-common-framework">
<h3>2.3 Tailor-made methods in a common framework<a class="headerlink" href="#tailor-made-methods-in-a-common-framework" title="Permalink to this headline">¶</a></h3>
<p>In the section above, we showed how it is possible to use scikit-downscale to bias-correct a timeseries of daily maximum air temperature using an arbitrary collection of linear models. Some of those models were general machine learning methods (e.g. <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>) while others were tailor-made methods developed specifically for downscaling (e.g. <code class="docutils literal notranslate"><span class="pre">BCSDTemperature</span></code>). In this section, we walk through how new pointwise methods can be added to the scikit-downscale framework, highlighting the Z-Score method along the way.</p>
<div class="section" id="z-score-method">
<h4>2.3.1 Z-Score Method<a class="headerlink" href="#z-score-method" title="Permalink to this headline">¶</a></h4>
<p>Z-Score bias correction is a good technique for target variables with Gaussian probability distributions, such as zonal wind speed.</p>
<p>In essence the technique:</p>
<ol class="simple">
<li><p>Finds the mean<br />
$<span class="math notranslate nohighlight">\(\overline{x} = \sum_{i=0}^N \frac{x_i}{N}\)</span><span class="math notranslate nohighlight">\( 
and standard deviation 
\)</span><span class="math notranslate nohighlight">\(\sigma = \sqrt{\frac{\sum_{i=0}^N |x_i - \overline{x}|^2}{N-1}}\)</span>$
of target (measured) data and training (historical modeled) data.</p></li>
<li><p>Compares the difference between the statistical values to produce a shift
$<span class="math notranslate nohighlight">\(shift = \overline{x_{target}} - \overline{x_{training}}\)</span><span class="math notranslate nohighlight">\( 
and scale parameter 
\)</span><span class="math notranslate nohighlight">\(scale = \sigma_{target} \div \sigma_{training}\)</span>$</p></li>
<li><p>Applies these paramaters to the future model data to be corrected to get a new mean
$<span class="math notranslate nohighlight">\(\overline{x_{corrected}} = \overline{x_{future}} + shift\)</span><span class="math notranslate nohighlight">\(
and new standard deviation
\)</span><span class="math notranslate nohighlight">\(\sigma_{corrected} = \sigma_{future} \times scale\)</span>$</p></li>
<li><p>Calculates the corrected values
$<span class="math notranslate nohighlight">\(x_{corrected_{i}} = z_i \times \sigma_{corrected} + \overline{x_{corrected}}\)</span><span class="math notranslate nohighlight">\(
from the future model's z-score values
\)</span><span class="math notranslate nohighlight">\(z_i = \frac{x_i-\overline{x}}{\sigma}\)</span>$</p></li>
</ol>
<p>In practice, if the wind was on average 3 m/s faster on the first of July in the models compared to the measurements, we would adjust the modeled data for all July 1sts in the future modeled dataset to be 3 m/s faster. And similarly for scaling the standard deviation</p>
</div>
<div class="section" id="building-the-zscoreregressor-class">
<h4>2.3.2 Building the ZScoreRegressor Class<a class="headerlink" href="#building-the-zscoreregressor-class" title="Permalink to this headline">¶</a></h4>
<p>Scikit-downscale’s pointwise all implement Scikit-learn’s <code class="docutils literal notranslate"><span class="pre">fit</span></code>/<code class="docutils literal notranslate"><span class="pre">predict</span></code> API. Each new downscaler must implement a minimum of three class methods: <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">predict</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AbstractDownscaler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">y_hat</span>
</pre></div>
</div>
<p>Ommitting some of the complexity in the full implementation (which can be found in the <a class="reference external" href="https://github.com/jhamman/scikit-downscale/blob/master/skdownscale/pointwise_models/zscore.py">full implementation on GitHub</a>), we demonstrate how the <code class="docutils literal notranslate"><span class="pre">ZScoreRegressor</span></code> was built:</p>
<p>First, we define our <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method, allowing users to specify specific options (in this case <code class="docutils literal notranslate"><span class="pre">window_width</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ZScoreRegressor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_width</span><span class="o">=</span><span class="mi">31</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_width</span> <span class="o">=</span> <span class="n">window_width</span>
</pre></div>
</div>
<p>Next, we define our <code class="docutils literal notranslate"><span class="pre">fit</span></code> method,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">X_mean</span><span class="p">,</span> <span class="n">X_std</span> <span class="o">=</span> <span class="n">_calc_stats</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_width</span><span class="p">)</span>
        <span class="n">y_mean</span><span class="p">,</span> <span class="n">y_std</span> <span class="o">=</span> <span class="n">_calc_stats</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_width</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict_</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;X_mean&quot;</span><span class="p">:</span> <span class="n">X_mean</span><span class="p">,</span>
            <span class="s2">&quot;X_std&quot;</span><span class="p">:</span> <span class="n">X_std</span><span class="p">,</span>
            <span class="s2">&quot;y_mean&quot;</span><span class="p">:</span> <span class="n">y_mean</span><span class="p">,</span>
            <span class="s2">&quot;y_std&quot;</span><span class="p">:</span> <span class="n">y_std</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">shift</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">_get_params</span><span class="p">(</span><span class="n">X_mean</span><span class="p">,</span> <span class="n">X_std</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">y_std</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shift_</span> <span class="o">=</span> <span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>Finally, we define our <code class="docutils literal notranslate"><span class="pre">predict</span></code> method,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="n">fut_mean</span><span class="p">,</span> <span class="n">fut_std</span><span class="p">,</span> <span class="n">fut_zscore</span> <span class="o">=</span> <span class="n">_get_fut_stats</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_width</span><span class="p">)</span>
        <span class="n">shift_expanded</span><span class="p">,</span> <span class="n">scale_expanded</span> <span class="o">=</span> <span class="n">_expand_params</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_</span><span class="p">)</span>

        <span class="n">fut_mean_corrected</span><span class="p">,</span> <span class="n">fut_std_corrected</span> <span class="o">=</span> <span class="n">_correct_fut_stats</span><span class="p">(</span>
            <span class="n">fut_mean</span><span class="p">,</span> <span class="n">fut_std</span><span class="p">,</span> <span class="n">shift_expanded</span><span class="p">,</span> <span class="n">scale_expanded</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fut_stats_dict_</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;meani&quot;</span><span class="p">:</span> <span class="n">fut_mean</span><span class="p">,</span>
            <span class="s2">&quot;stdi&quot;</span><span class="p">:</span> <span class="n">fut_std</span><span class="p">,</span>
            <span class="s2">&quot;meanf&quot;</span><span class="p">:</span> <span class="n">fut_mean_corrected</span><span class="p">,</span>
            <span class="s2">&quot;stdf&quot;</span><span class="p">:</span> <span class="n">fut_std_corrected</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">fut_corrected</span> <span class="o">=</span> <span class="p">(</span><span class="n">fut_zscore</span> <span class="o">*</span> <span class="n">fut_std_corrected</span><span class="p">)</span> <span class="o">+</span> <span class="n">fut_mean_corrected</span>

        <span class="k">return</span> <span class="n">fut_corrected</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skdownscale.pointwise_models</span> <span class="kn">import</span> <span class="n">ZScoreRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open a small dataset</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">get_sample_data</span><span class="p">(</span><span class="s1">&#39;wind-hist&#39;</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">get_sample_data</span><span class="p">(</span><span class="s1">&#39;wind-obs&#39;</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">get_sample_data</span><span class="p">(</span><span class="s1">&#39;wind-rcp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bias correction using ZScoreRegresssor</span>
<span class="n">zscore</span> <span class="o">=</span> <span class="n">ZScoreRegressor</span><span class="p">()</span>
<span class="n">zscore</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="n">fit_stats</span> <span class="o">=</span> <span class="n">zscore</span><span class="o">.</span><span class="n">fit_stats_dict_</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">zscore</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">predict_stats</span> <span class="o">=</span> <span class="n">zscore</span><span class="o">.</span><span class="n">predict_stats_dict_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the datasets</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">zscore_ds_plot</span>

<span class="n">zscore_ds_plot</span><span class="p">(</span><span class="n">training</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">future</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2020ECAHM-scikit-downscale_27_0.png" src="../../_images/2020ECAHM-scikit-downscale_27_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">zscore_correction_plot</span>

<span class="n">zscore_correction_plot</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2020ECAHM-scikit-downscale_28_0.png" src="../../_images/2020ECAHM-scikit-downscale_28_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="automatic-parallelization">
<h3>2.4 Automatic Parallelization<a class="headerlink" href="#automatic-parallelization" title="Permalink to this headline">¶</a></h3>
<p>In the examples above, we have performed downscaling on sample data sourced from individual points. In many downscaling workflows, however, users will want to apply pointwise methods at all points in their study domain. For this use case, scikit-downscale provides a high-level wrapper class: <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler</span></code>.</p>
<p>In the example below, we’ll use the <code class="docutils literal notranslate"><span class="pre">BCSDTemperature</span></code> model, along with the <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler</span></code> wrapper, to downscale daily maximum surface air temperature from CMIP6 for all point in a subset of the Pacific Norwest. We’ll use a local <a class="reference external" href="https://dask.org/">Dask Cluster</a> to distribute the computation among our available processors. Though not the point of this example, we also use <a class="reference external" href="https://intake-esm.readthedocs.io/en/latest/">intake-esm</a> to access <a class="reference external" href="https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6">CMIP6</a> data stored on <a class="reference external" href="https://console.cloud.google.com/marketplace/details/noaa-public/cmip6">Google Cloud Storage</a>.</p>
<p><strong>Data:</strong></p>
<ul class="simple">
<li><p>Training / Prediction data: NASA-GISS-E2 historical data from CMIP6</p></li>
<li><p>Targets: <a class="reference external" href="http://www.climatologylab.org/gridmet.html">GridMet</a> daily maximum surface air temperature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">train_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1980&#39;</span><span class="p">,</span> <span class="s1">&#39;1982&#39;</span><span class="p">)</span>  <span class="c1"># train time range</span>
<span class="n">holdout_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1990&#39;</span><span class="p">,</span> <span class="s1">&#39;1991&#39;</span><span class="p">)</span>  <span class="c1"># prediction time range</span>

<span class="c1"># bounding box of downscaling region</span>
<span class="n">lon_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">124.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.0</span><span class="p">)</span> 
<span class="n">lat_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>

<span class="c1"># chunk shape for dask execution (time must be contiguous, ie -1)</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Step 1: Start a Dask Cluster. Xarray and the <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler</span></code> will make use of this cluster when it comes time to load input data and train/predict downscaling models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Client</h3>
<ul style="text-align: left; list-style: none; margin: 0; padding: 0;">
  <li><b>Scheduler: </b>tcp://127.0.0.1:41711</li>
  <li><b>Dashboard: </b><a href='/user/jhamman/proxy/8787/status' target='_blank'>/user/jhamman/proxy/8787/status</a></li>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Cluster</h3>
<ul style="text-align: left; list-style:none; margin: 0; padding: 0;">
  <li><b>Workers: </b>4</li>
  <li><b>Cores: </b>4</li>
  <li><b>Memory: </b>25.77 GB</li>
</ul>
</td>
</tr>
</table></div></div>
</div>
<p>Step 2. Load our target data.</p>
<p>Here we use xarray directly to load a collection of OpenDAP endpoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;http://thredds.northwestknowledge.net:8080/thredds/dodsC/MET/tmmx/tmmx_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.nc&#39;</span>
          <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">train_slice</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">train_slice</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
<span class="c1"># open the data and cleanup a bit of metadata</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pydap&#39;</span><span class="p">,</span> <span class="n">concat_dim</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;crs&#39;</span><span class="p">)</span>

<span class="n">obs_subset</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">train_slice</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s1">&#39;threads&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="c1"># display</span>
<span class="n">display</span><span class="p">(</span><span class="n">obs_subset</span><span class="p">)</span>
<span class="n">obs_subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;air_temperature&#x27; (time: 1096, lat: 106, lon: 115)&gt;
dask.array&lt;xarray-&lt;this-array&gt;, shape=(1096, 106, 115), dtype=float32, chunksize=(1096, 10, 10), chunktype=numpy.ndarray&gt;
Coordinates:
  * time     (time) datetime64[ns] 1980-01-01 1980-01-02 ... 1982-12-31
  * lat      (lat) float64 49.4 49.36 49.32 49.28 ... 45.15 45.11 45.07 45.03
  * lon      (lon) float64 -124.8 -124.7 -124.7 -124.6 ... -120.1 -120.1 -120.0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'air_temperature'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1096</li><li><span class='xr-has-index'>lat</span>: 106</li><li><span class='xr-has-index'>lon</span>: 115</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-f2320833-20cf-4ab3-a83c-8b3dd9c0e4be' class='xr-array-in' type='checkbox' ><label for='section-f2320833-20cf-4ab3-a83c-8b3dd9c0e4be' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(1096, 10, 10), meta=np.ndarray&gt;</span></div><pre class='xr-array-data'><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 53.44 MB </td> <td> 438.40 kB </td></tr>
    <tr><th> Shape </th><td> (1096, 106, 115) </td> <td> (1096, 10, 10) </td></tr>
    <tr><th> Count </th><td> 133 Tasks </td><td> 132 Chunks </td></tr>
    <tr><th> Type </th><td> float32 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="169" height="158" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="3" x2="80" y2="74" />
  <line x1="10" y1="7" x2="80" y2="77" />
  <line x1="10" y1="10" x2="80" y2="81" />
  <line x1="10" y1="14" x2="80" y2="85" />
  <line x1="10" y1="18" x2="80" y2="88" />
  <line x1="10" y1="21" x2="80" y2="92" />
  <line x1="10" y1="25" x2="80" y2="95" />
  <line x1="10" y1="28" x2="80" y2="99" />
  <line x1="10" y1="32" x2="80" y2="103" />
  <line x1="10" y1="36" x2="80" y2="106" />
  <line x1="10" y1="38" x2="80" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="38" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 80.588235,70.588235 80.588235,108.999188 10.000000,38.410953" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="48" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="13" y1="0" x2="83" y2="70" />
  <line x1="16" y1="0" x2="87" y2="70" />
  <line x1="20" y1="0" x2="90" y2="70" />
  <line x1="23" y1="0" x2="94" y2="70" />
  <line x1="26" y1="0" x2="97" y2="70" />
  <line x1="30" y1="0" x2="100" y2="70" />
  <line x1="33" y1="0" x2="104" y2="70" />
  <line x1="37" y1="0" x2="107" y2="70" />
  <line x1="40" y1="0" x2="111" y2="70" />
  <line x1="43" y1="0" x2="114" y2="70" />
  <line x1="47" y1="0" x2="117" y2="70" />
  <line x1="48" y1="0" x2="119" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 48.861672,0.000000 119.449907,70.588235 80.588235,70.588235" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />
  <line x1="80" y1="74" x2="119" y2="74" />
  <line x1="80" y1="77" x2="119" y2="77" />
  <line x1="80" y1="81" x2="119" y2="81" />
  <line x1="80" y1="85" x2="119" y2="85" />
  <line x1="80" y1="88" x2="119" y2="88" />
  <line x1="80" y1="92" x2="119" y2="92" />
  <line x1="80" y1="95" x2="119" y2="95" />
  <line x1="80" y1="99" x2="119" y2="99" />
  <line x1="80" y1="103" x2="119" y2="103" />
  <line x1="80" y1="106" x2="119" y2="106" />
  <line x1="80" y1="108" x2="119" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />
  <line x1="83" y1="70" x2="83" y2="108" />
  <line x1="87" y1="70" x2="87" y2="108" />
  <line x1="90" y1="70" x2="90" y2="108" />
  <line x1="94" y1="70" x2="94" y2="108" />
  <line x1="97" y1="70" x2="97" y2="108" />
  <line x1="100" y1="70" x2="100" y2="108" />
  <line x1="104" y1="70" x2="104" y2="108" />
  <line x1="107" y1="70" x2="107" y2="108" />
  <line x1="111" y1="70" x2="111" y2="108" />
  <line x1="114" y1="70" x2="114" y2="108" />
  <line x1="117" y1="70" x2="117" y2="108" />
  <line x1="119" y1="70" x2="119" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.588235,70.588235 119.449907,70.588235 119.449907,108.999188 80.588235,108.999188" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="100.019071" y="128.999188" font-size="1.0rem" font-weight="100" text-anchor="middle" >115</text>
  <text x="139.449907" y="89.793712" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,139.449907,89.793712)">106</text>
  <text x="35.294118" y="93.705071" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,93.705071)">1096</text>
</svg>
</td>
</tr>
</table></pre></div></li><li class='xr-section-item'><input id='section-b8392143-782c-40d1-a48b-b45cf9de75d3' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b8392143-782c-40d1-a48b-b45cf9de75d3' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1980-01-01 ... 1982-12-31</div><input id='attrs-fdafd49c-6b0b-4c81-b47a-a5d8948db092' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fdafd49c-6b0b-4c81-b47a-a5d8948db092' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fffe2f6e-0b44-405c-b63f-092213f44f4a' class='xr-var-data-in' type='checkbox'><label for='data-fffe2f6e-0b44-405c-b63f-092213f44f4a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([&#x27;1980-01-01T00:00:00.000000000&#x27;, &#x27;1980-01-02T00:00:00.000000000&#x27;,
       &#x27;1980-01-03T00:00:00.000000000&#x27;, ..., &#x27;1982-12-29T00:00:00.000000000&#x27;,
       &#x27;1982-12-30T00:00:00.000000000&#x27;, &#x27;1982-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.4 49.36 49.32 ... 45.07 45.03</div><input id='attrs-c1d2a1d7-00d5-4a39-baff-91c2748efe7a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c1d2a1d7-00d5-4a39-baff-91c2748efe7a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e90fc4d2-e0bf-4047-b7d2-b0927b17787e' class='xr-var-data-in' type='checkbox'><label for='data-e90fc4d2-e0bf-4047-b7d2-b0927b17787e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>description :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>axis :</span></dt><dd>Y</dd><dt><span>_ChunkSizes :</span></dt><dd>585</dd></dl></div><pre class='xr-var-data'>array([49.4     , 49.358333, 49.316667, 49.275   , 49.233333, 49.191667,
       49.15    , 49.108333, 49.066667, 49.025   , 48.983333, 48.941667,
       48.9     , 48.858333, 48.816667, 48.775   , 48.733333, 48.691667,
       48.65    , 48.608333, 48.566667, 48.525   , 48.483333, 48.441667,
       48.4     , 48.358333, 48.316667, 48.275   , 48.233333, 48.191667,
       48.15    , 48.108333, 48.066667, 48.025   , 47.983333, 47.941667,
       47.9     , 47.858333, 47.816667, 47.775   , 47.733333, 47.691667,
       47.65    , 47.608333, 47.566667, 47.525   , 47.483333, 47.441667,
       47.4     , 47.358333, 47.316667, 47.275   , 47.233333, 47.191667,
       47.15    , 47.108333, 47.066667, 47.025   , 46.983333, 46.941667,
       46.9     , 46.858333, 46.816667, 46.775   , 46.733333, 46.691667,
       46.65    , 46.608333, 46.566667, 46.525   , 46.483333, 46.441667,
       46.4     , 46.358333, 46.316667, 46.275   , 46.233333, 46.191667,
       46.15    , 46.108333, 46.066667, 46.025   , 45.983333, 45.941667,
       45.9     , 45.858333, 45.816667, 45.775   , 45.733333, 45.691667,
       45.65    , 45.608333, 45.566667, 45.525   , 45.483333, 45.441667,
       45.4     , 45.358333, 45.316667, 45.275   , 45.233333, 45.191667,
       45.15    , 45.108333, 45.066667, 45.025   ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-124.8 -124.7 ... -120.1 -120.0</div><input id='attrs-62328956-bc96-432b-abdf-b609fe5a9799' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-62328956-bc96-432b-abdf-b609fe5a9799' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-465081cf-2a90-4a8c-9c36-547040aa831d' class='xr-var-data-in' type='checkbox'><label for='data-465081cf-2a90-4a8c-9c36-547040aa831d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>description :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>axis :</span></dt><dd>X</dd><dt><span>_ChunkSizes :</span></dt><dd>1386</dd></dl></div><pre class='xr-var-data'>array([-124.766667, -124.725   , -124.683333, -124.641667, -124.6     ,
       -124.558333, -124.516667, -124.475   , -124.433333, -124.391667,
       -124.35    , -124.308333, -124.266667, -124.225   , -124.183333,
       -124.141667, -124.1     , -124.058333, -124.016667, -123.975   ,
       -123.933333, -123.891667, -123.85    , -123.808333, -123.766667,
       -123.725   , -123.683333, -123.641667, -123.6     , -123.558333,
       -123.516667, -123.475   , -123.433333, -123.391667, -123.35    ,
       -123.308333, -123.266667, -123.225   , -123.183333, -123.141667,
       -123.1     , -123.058333, -123.016667, -122.975   , -122.933333,
       -122.891667, -122.85    , -122.808333, -122.766667, -122.725   ,
       -122.683333, -122.641667, -122.6     , -122.558333, -122.516667,
       -122.475   , -122.433333, -122.391667, -122.35    , -122.308333,
       -122.266667, -122.225   , -122.183333, -122.141667, -122.1     ,
       -122.058333, -122.016667, -121.975   , -121.933333, -121.891667,
       -121.85    , -121.808333, -121.766667, -121.725   , -121.683333,
       -121.641667, -121.6     , -121.558333, -121.516667, -121.475   ,
       -121.433333, -121.391667, -121.35    , -121.308333, -121.266667,
       -121.225   , -121.183333, -121.141667, -121.1     , -121.058333,
       -121.016667, -120.975   , -120.933333, -120.891667, -120.85    ,
       -120.808333, -120.766667, -120.725   , -120.683333, -120.641667,
       -120.6     , -120.558333, -120.516667, -120.475   , -120.433333,
       -120.391667, -120.35    , -120.308333, -120.266667, -120.225   ,
       -120.183333, -120.141667, -120.1     , -120.058333, -120.016667])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-35de08e7-516c-416e-833e-b43609fb24c3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-35de08e7-516c-416e-833e-b43609fb24c3' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fbffec07610&gt;
</pre></div>
</div>
</div>
</div>
<p>Step 3: Load our training/prediction data.</p>
<p>Here we use <code class="docutils literal notranslate"><span class="pre">intake-esm</span></code> to access a single Xarray dataset from the Pangeo’s Google Cloud CMIP6 data catalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">intake_esm</span>
<span class="n">intake_esm</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2020.6.11&#39;
</pre></div>
</div>
<img alt="../../_images/2020ECAHM-scikit-downscale_36_1.png" src="../../_images/2020ECAHM-scikit-downscale_36_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">intake</span>

<span class="c1"># search the cmip6 catalog</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span><span class="s2">&quot;https://storage.googleapis.com/cmip6/pangeo-cmip6.json&quot;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp585&#39;</span><span class="p">],</span> <span class="n">table_id</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">variable_id</span><span class="o">=</span><span class="s1">&#39;tasmax&#39;</span><span class="p">,</span>
                 <span class="n">grid_label</span><span class="o">=</span><span class="s1">&#39;gn&#39;</span><span class="p">)</span>

<span class="c1"># access the data and do some cleanup</span>
<span class="n">ds_model</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;CMIP.NASA-GISS.GISS-E2-1-G.historical.day.gn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;lat_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;lon_bnds&#39;</span><span class="p">,</span> <span class="s1">&#39;time_bnds&#39;</span><span class="p">])</span>
<span class="n">ds_model</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ds_model</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>
<span class="n">ds_model</span> <span class="o">=</span> <span class="n">ds_model</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">roll_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># regional subsets, ready for downscaling</span>
<span class="n">train_subset</span> <span class="o">=</span> <span class="n">ds_model</span><span class="p">[</span><span class="s1">&#39;tasmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">train_slice</span><span class="p">)</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">obs_subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">train_subset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_subset</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_datetimeindex</span><span class="p">()</span>
<span class="n">train_subset</span> <span class="o">=</span> <span class="n">train_subset</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s1">&#39;threads&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="n">holdout_subset</span> <span class="o">=</span> <span class="n">ds_model</span><span class="p">[</span><span class="s1">&#39;tasmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">holdout_slice</span><span class="p">)</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">obs_subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">holdout_subset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">holdout_subset</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_datetimeindex</span><span class="p">()</span>
<span class="n">holdout_subset</span> <span class="o">=</span> <span class="n">holdout_subset</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s1">&#39;threads&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="c1"># display</span>
<span class="n">display</span><span class="p">(</span><span class="n">train_subset</span><span class="p">)</span>
<span class="n">train_subset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tasmax&#x27; (time: 1096, lat: 106, lon: 115)&gt;
dask.array&lt;xarray-&lt;this-array&gt;, shape=(1096, 106, 115), dtype=float32, chunksize=(1096, 10, 10), chunktype=numpy.ndarray&gt;
Coordinates:
  * time     (time) datetime64[ns] 1980-01-01 1980-01-02 ... 1982-12-31
  * lat      (lat) float64 49.4 49.36 49.32 49.28 ... 45.15 45.11 45.07 45.03
  * lon      (lon) float64 -124.8 -124.7 -124.7 -124.6 ... -120.1 -120.1 -120.0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tasmax'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1096</li><li><span class='xr-has-index'>lat</span>: 106</li><li><span class='xr-has-index'>lon</span>: 115</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-8a8d47ac-1783-40ab-8c40-21960cbafc4c' class='xr-array-in' type='checkbox' ><label for='section-8a8d47ac-1783-40ab-8c40-21960cbafc4c' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(1096, 10, 10), meta=np.ndarray&gt;</span></div><pre class='xr-array-data'><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 53.44 MB </td> <td> 438.40 kB </td></tr>
    <tr><th> Shape </th><td> (1096, 106, 115) </td> <td> (1096, 10, 10) </td></tr>
    <tr><th> Count </th><td> 133 Tasks </td><td> 132 Chunks </td></tr>
    <tr><th> Type </th><td> float32 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="169" height="158" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="3" x2="80" y2="74" />
  <line x1="10" y1="7" x2="80" y2="77" />
  <line x1="10" y1="10" x2="80" y2="81" />
  <line x1="10" y1="14" x2="80" y2="85" />
  <line x1="10" y1="18" x2="80" y2="88" />
  <line x1="10" y1="21" x2="80" y2="92" />
  <line x1="10" y1="25" x2="80" y2="95" />
  <line x1="10" y1="28" x2="80" y2="99" />
  <line x1="10" y1="32" x2="80" y2="103" />
  <line x1="10" y1="36" x2="80" y2="106" />
  <line x1="10" y1="38" x2="80" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="38" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 80.588235,70.588235 80.588235,108.999188 10.000000,38.410953" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="48" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="13" y1="0" x2="83" y2="70" />
  <line x1="16" y1="0" x2="87" y2="70" />
  <line x1="20" y1="0" x2="90" y2="70" />
  <line x1="23" y1="0" x2="94" y2="70" />
  <line x1="26" y1="0" x2="97" y2="70" />
  <line x1="30" y1="0" x2="100" y2="70" />
  <line x1="33" y1="0" x2="104" y2="70" />
  <line x1="37" y1="0" x2="107" y2="70" />
  <line x1="40" y1="0" x2="111" y2="70" />
  <line x1="43" y1="0" x2="114" y2="70" />
  <line x1="47" y1="0" x2="117" y2="70" />
  <line x1="48" y1="0" x2="119" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 48.861672,0.000000 119.449907,70.588235 80.588235,70.588235" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />
  <line x1="80" y1="74" x2="119" y2="74" />
  <line x1="80" y1="77" x2="119" y2="77" />
  <line x1="80" y1="81" x2="119" y2="81" />
  <line x1="80" y1="85" x2="119" y2="85" />
  <line x1="80" y1="88" x2="119" y2="88" />
  <line x1="80" y1="92" x2="119" y2="92" />
  <line x1="80" y1="95" x2="119" y2="95" />
  <line x1="80" y1="99" x2="119" y2="99" />
  <line x1="80" y1="103" x2="119" y2="103" />
  <line x1="80" y1="106" x2="119" y2="106" />
  <line x1="80" y1="108" x2="119" y2="108" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="108" style="stroke-width:2" />
  <line x1="83" y1="70" x2="83" y2="108" />
  <line x1="87" y1="70" x2="87" y2="108" />
  <line x1="90" y1="70" x2="90" y2="108" />
  <line x1="94" y1="70" x2="94" y2="108" />
  <line x1="97" y1="70" x2="97" y2="108" />
  <line x1="100" y1="70" x2="100" y2="108" />
  <line x1="104" y1="70" x2="104" y2="108" />
  <line x1="107" y1="70" x2="107" y2="108" />
  <line x1="111" y1="70" x2="111" y2="108" />
  <line x1="114" y1="70" x2="114" y2="108" />
  <line x1="117" y1="70" x2="117" y2="108" />
  <line x1="119" y1="70" x2="119" y2="108" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.588235,70.588235 119.449907,70.588235 119.449907,108.999188 80.588235,108.999188" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="100.019071" y="128.999188" font-size="1.0rem" font-weight="100" text-anchor="middle" >115</text>
  <text x="139.449907" y="89.793712" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,139.449907,89.793712)">106</text>
  <text x="35.294118" y="93.705071" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,93.705071)">1096</text>
</svg>
</td>
</tr>
</table></pre></div></li><li class='xr-section-item'><input id='section-8a9ce94e-2f0c-493b-ad6f-17a2856e305c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8a9ce94e-2f0c-493b-ad6f-17a2856e305c' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1980-01-01 ... 1982-12-31</div><input id='attrs-7da91e89-039a-418d-8138-7499d28caa48' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7da91e89-039a-418d-8138-7499d28caa48' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6ffcee16-046f-4e14-b147-40340bce968f' class='xr-var-data-in' type='checkbox'><label for='data-6ffcee16-046f-4e14-b147-40340bce968f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([&#x27;1980-01-01T00:00:00.000000000&#x27;, &#x27;1980-01-02T00:00:00.000000000&#x27;,
       &#x27;1980-01-03T00:00:00.000000000&#x27;, ..., &#x27;1982-12-29T00:00:00.000000000&#x27;,
       &#x27;1982-12-30T00:00:00.000000000&#x27;, &#x27;1982-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.4 49.36 49.32 ... 45.07 45.03</div><input id='attrs-c716bf2f-d383-4c25-b198-111f589fe893' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c716bf2f-d383-4c25-b198-111f589fe893' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cf9e6c01-38e7-4ba3-ba79-a8829ff17902' class='xr-var-data-in' type='checkbox'><label for='data-cf9e6c01-38e7-4ba3-ba79-a8829ff17902' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([49.4     , 49.358333, 49.316667, 49.275   , 49.233333, 49.191667,
       49.15    , 49.108333, 49.066667, 49.025   , 48.983333, 48.941667,
       48.9     , 48.858333, 48.816667, 48.775   , 48.733333, 48.691667,
       48.65    , 48.608333, 48.566667, 48.525   , 48.483333, 48.441667,
       48.4     , 48.358333, 48.316667, 48.275   , 48.233333, 48.191667,
       48.15    , 48.108333, 48.066667, 48.025   , 47.983333, 47.941667,
       47.9     , 47.858333, 47.816667, 47.775   , 47.733333, 47.691667,
       47.65    , 47.608333, 47.566667, 47.525   , 47.483333, 47.441667,
       47.4     , 47.358333, 47.316667, 47.275   , 47.233333, 47.191667,
       47.15    , 47.108333, 47.066667, 47.025   , 46.983333, 46.941667,
       46.9     , 46.858333, 46.816667, 46.775   , 46.733333, 46.691667,
       46.65    , 46.608333, 46.566667, 46.525   , 46.483333, 46.441667,
       46.4     , 46.358333, 46.316667, 46.275   , 46.233333, 46.191667,
       46.15    , 46.108333, 46.066667, 46.025   , 45.983333, 45.941667,
       45.9     , 45.858333, 45.816667, 45.775   , 45.733333, 45.691667,
       45.65    , 45.608333, 45.566667, 45.525   , 45.483333, 45.441667,
       45.4     , 45.358333, 45.316667, 45.275   , 45.233333, 45.191667,
       45.15    , 45.108333, 45.066667, 45.025   ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-124.8 -124.7 ... -120.1 -120.0</div><input id='attrs-d441f26e-f931-48f0-b133-321483c89d61' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d441f26e-f931-48f0-b133-321483c89d61' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-700d18a2-b880-4330-aaa9-319b478a4b1f' class='xr-var-data-in' type='checkbox'><label for='data-700d18a2-b880-4330-aaa9-319b478a4b1f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-124.766667, -124.725   , -124.683333, -124.641667, -124.6     ,
       -124.558333, -124.516667, -124.475   , -124.433333, -124.391667,
       -124.35    , -124.308333, -124.266667, -124.225   , -124.183333,
       -124.141667, -124.1     , -124.058333, -124.016667, -123.975   ,
       -123.933333, -123.891667, -123.85    , -123.808333, -123.766667,
       -123.725   , -123.683333, -123.641667, -123.6     , -123.558333,
       -123.516667, -123.475   , -123.433333, -123.391667, -123.35    ,
       -123.308333, -123.266667, -123.225   , -123.183333, -123.141667,
       -123.1     , -123.058333, -123.016667, -122.975   , -122.933333,
       -122.891667, -122.85    , -122.808333, -122.766667, -122.725   ,
       -122.683333, -122.641667, -122.6     , -122.558333, -122.516667,
       -122.475   , -122.433333, -122.391667, -122.35    , -122.308333,
       -122.266667, -122.225   , -122.183333, -122.141667, -122.1     ,
       -122.058333, -122.016667, -121.975   , -121.933333, -121.891667,
       -121.85    , -121.808333, -121.766667, -121.725   , -121.683333,
       -121.641667, -121.6     , -121.558333, -121.516667, -121.475   ,
       -121.433333, -121.391667, -121.35    , -121.308333, -121.266667,
       -121.225   , -121.183333, -121.141667, -121.1     , -121.058333,
       -121.016667, -120.975   , -120.933333, -120.891667, -120.85    ,
       -120.808333, -120.766667, -120.725   , -120.683333, -120.641667,
       -120.6     , -120.558333, -120.516667, -120.475   , -120.433333,
       -120.391667, -120.35    , -120.308333, -120.266667, -120.225   ,
       -120.183333, -120.141667, -120.1     , -120.058333, -120.016667])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-f9a70d40-0adb-4605-be6d-ecfd67a51bf1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f9a70d40-0adb-4605-be6d-ecfd67a51bf1' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fbffe6eff70&gt;
</pre></div>
</div>
<img alt="../../_images/2020ECAHM-scikit-downscale_37_2.png" src="../../_images/2020ECAHM-scikit-downscale_37_2.png" />
</div>
</div>
<p>Step 4. Now that we have loaded our training and target data, we can move on to fit our BcsdTemperature model at each x/y point in our domain. This is where the <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler</span></code> comes in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skdownscale.pointwise_models</span> <span class="kn">import</span> <span class="n">PointWiseDownscaler</span>
<span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ProgressBar</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">PointWiseDownscaler</span><span class="p">(</span><span class="n">BcsdTemperature</span><span class="p">(</span><span class="n">return_anoms</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;skdownscale.PointWiseDownscaler&gt;
  Fit Status: False
  Model:
    BcsdTemperature(return_anoms=False)
</pre></div>
</div>
</div>
</div>
<p>Step 5. We fit the <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler</span></code>, passing it data in Xarray data structures (our regional subsets from above). This opperation is lazy and return immediately. Under the hood, we can see that <code class="docutils literal notranslate"><span class="pre">PointWiseDownscaler._models</span></code> is an <code class="docutils literal notranslate"><span class="pre">Xarray.DataArray</span></code> of <code class="docutils literal notranslate"><span class="pre">BcsdTemperature</span></code> models.</p>
<div class="alert-warning">
Note: The following two cells may take a few minutes, or longer, to complete depending on how many cores your computer has, and your internet connection.     
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_subset</span><span class="p">,</span> <span class="n">obs_subset</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">_models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;skdownscale.PointWiseDownscaler&gt;
  Fit Status: True
  Model:
    BcsdTemperature(return_anoms=False)
</pre></div>
</div>
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tasmax&#x27; (lat: 106, lon: 115)&gt;
dask.array&lt;_fit_wrapper-723171662d2ffd5ed708bc9f7d1b3a95-&lt;this, shape=(106, 115), dtype=object, chunksize=(10, 10), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float64 49.4 49.36 49.32 49.28 ... 45.15 45.11 45.07 45.03
  * lon      (lon) float64 -124.8 -124.7 -124.7 -124.6 ... -120.1 -120.1 -120.0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tasmax'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 106</li><li><span class='xr-has-index'>lon</span>: 115</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-e64602b5-2c51-4a06-bcee-c0f6c555c60a' class='xr-array-in' type='checkbox' ><label for='section-e64602b5-2c51-4a06-bcee-c0f6c555c60a' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(10, 10), meta=np.ndarray&gt;</span></div><pre class='xr-array-data'><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 97.52 kB </td> <td> 800 B </td></tr>
    <tr><th> Shape </th><td> (106, 115) </td> <td> (10, 10) </td></tr>
    <tr><th> Count </th><td> 1850 Tasks </td><td> 132 Chunks </td></tr>
    <tr><th> Type </th><td> object </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="170" height="160" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="10" x2="120" y2="10" />
  <line x1="0" y1="20" x2="120" y2="20" />
  <line x1="0" y1="31" x2="120" y2="31" />
  <line x1="0" y1="41" x2="120" y2="41" />
  <line x1="0" y1="52" x2="120" y2="52" />
  <line x1="0" y1="62" x2="120" y2="62" />
  <line x1="0" y1="73" x2="120" y2="73" />
  <line x1="0" y1="83" x2="120" y2="83" />
  <line x1="0" y1="93" x2="120" y2="93" />
  <line x1="0" y1="104" x2="120" y2="104" />
  <line x1="0" y1="110" x2="120" y2="110" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="110" style="stroke-width:2" />
  <line x1="10" y1="0" x2="10" y2="110" />
  <line x1="20" y1="0" x2="20" y2="110" />
  <line x1="31" y1="0" x2="31" y2="110" />
  <line x1="41" y1="0" x2="41" y2="110" />
  <line x1="52" y1="0" x2="52" y2="110" />
  <line x1="62" y1="0" x2="62" y2="110" />
  <line x1="73" y1="0" x2="73" y2="110" />
  <line x1="83" y1="0" x2="83" y2="110" />
  <line x1="93" y1="0" x2="93" y2="110" />
  <line x1="104" y1="0" x2="104" y2="110" />
  <line x1="114" y1="0" x2="114" y2="110" />
  <line x1="120" y1="0" x2="120" y2="110" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.000000,0.000000 120.000000,0.000000 120.000000,110.608696 0.000000,110.608696" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="130.608696" font-size="1.0rem" font-weight="100" text-anchor="middle" >115</text>
  <text x="140.000000" y="55.304348" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,55.304348)">106</text>
</svg>
</td>
</tr>
</table></pre></div></li><li class='xr-section-item'><input id='section-4c1f1611-2ead-4f92-a310-4edc56dbe971' class='xr-section-summary-in' type='checkbox'  checked><label for='section-4c1f1611-2ead-4f92-a310-4edc56dbe971' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.4 49.36 49.32 ... 45.07 45.03</div><input id='attrs-b65cac5a-8114-4edb-8bfa-c2dd86f99885' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b65cac5a-8114-4edb-8bfa-c2dd86f99885' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b2bc6cab-b1b7-4de9-8b10-a9d358971654' class='xr-var-data-in' type='checkbox'><label for='data-b2bc6cab-b1b7-4de9-8b10-a9d358971654' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([49.4     , 49.358333, 49.316667, 49.275   , 49.233333, 49.191667,
       49.15    , 49.108333, 49.066667, 49.025   , 48.983333, 48.941667,
       48.9     , 48.858333, 48.816667, 48.775   , 48.733333, 48.691667,
       48.65    , 48.608333, 48.566667, 48.525   , 48.483333, 48.441667,
       48.4     , 48.358333, 48.316667, 48.275   , 48.233333, 48.191667,
       48.15    , 48.108333, 48.066667, 48.025   , 47.983333, 47.941667,
       47.9     , 47.858333, 47.816667, 47.775   , 47.733333, 47.691667,
       47.65    , 47.608333, 47.566667, 47.525   , 47.483333, 47.441667,
       47.4     , 47.358333, 47.316667, 47.275   , 47.233333, 47.191667,
       47.15    , 47.108333, 47.066667, 47.025   , 46.983333, 46.941667,
       46.9     , 46.858333, 46.816667, 46.775   , 46.733333, 46.691667,
       46.65    , 46.608333, 46.566667, 46.525   , 46.483333, 46.441667,
       46.4     , 46.358333, 46.316667, 46.275   , 46.233333, 46.191667,
       46.15    , 46.108333, 46.066667, 46.025   , 45.983333, 45.941667,
       45.9     , 45.858333, 45.816667, 45.775   , 45.733333, 45.691667,
       45.65    , 45.608333, 45.566667, 45.525   , 45.483333, 45.441667,
       45.4     , 45.358333, 45.316667, 45.275   , 45.233333, 45.191667,
       45.15    , 45.108333, 45.066667, 45.025   ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-124.8 -124.7 ... -120.1 -120.0</div><input id='attrs-76fdc59f-8fd4-4149-ac71-9cacb1187713' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-76fdc59f-8fd4-4149-ac71-9cacb1187713' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d8b997ba-2e46-40c9-9504-8f55406e75e0' class='xr-var-data-in' type='checkbox'><label for='data-d8b997ba-2e46-40c9-9504-8f55406e75e0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-124.766667, -124.725   , -124.683333, -124.641667, -124.6     ,
       -124.558333, -124.516667, -124.475   , -124.433333, -124.391667,
       -124.35    , -124.308333, -124.266667, -124.225   , -124.183333,
       -124.141667, -124.1     , -124.058333, -124.016667, -123.975   ,
       -123.933333, -123.891667, -123.85    , -123.808333, -123.766667,
       -123.725   , -123.683333, -123.641667, -123.6     , -123.558333,
       -123.516667, -123.475   , -123.433333, -123.391667, -123.35    ,
       -123.308333, -123.266667, -123.225   , -123.183333, -123.141667,
       -123.1     , -123.058333, -123.016667, -122.975   , -122.933333,
       -122.891667, -122.85    , -122.808333, -122.766667, -122.725   ,
       -122.683333, -122.641667, -122.6     , -122.558333, -122.516667,
       -122.475   , -122.433333, -122.391667, -122.35    , -122.308333,
       -122.266667, -122.225   , -122.183333, -122.141667, -122.1     ,
       -122.058333, -122.016667, -121.975   , -121.933333, -121.891667,
       -121.85    , -121.808333, -121.766667, -121.725   , -121.683333,
       -121.641667, -121.6     , -121.558333, -121.516667, -121.475   ,
       -121.433333, -121.391667, -121.35    , -121.308333, -121.266667,
       -121.225   , -121.183333, -121.141667, -121.1     , -121.058333,
       -121.016667, -120.975   , -120.933333, -120.891667, -120.85    ,
       -120.808333, -120.766667, -120.725   , -120.683333, -120.641667,
       -120.6     , -120.558333, -120.516667, -120.475   , -120.433333,
       -120.391667, -120.35    , -120.308333, -120.266667, -120.225   ,
       -120.183333, -120.141667, -120.1     , -120.058333, -120.016667])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-c5ae9491-891f-4ee5-bc4c-09080f8ff077' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c5ae9491-891f-4ee5-bc4c-09080f8ff077' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<p>Step 6. Finally, we can use our model to complete the downscaling workflow using the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method along with our <code class="docutils literal notranslate"><span class="pre">holdout_subset</span></code> of CMIP6 data. We call the <code class="docutils literal notranslate"><span class="pre">.load()</span></code> method to eagerly compute the data. We end by plotting a map of downscaled data over our study area.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predicted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">holdout_subset</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>
<span class="n">predicted</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (time: 730, lat: 106, lon: 115)&gt;
array([[[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 272.9068 , 272.03818,
         271.74667],
        [      nan,       nan,       nan, ..., 272.58118, 271.9899 ,
         271.59863],
        [      nan,       nan,       nan, ..., 272.38995, 271.89896,
         271.48502]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 272.2721 , 271.3799 ,
         271.10745],
        [      nan,       nan,       nan, ..., 271.8796 , 271.28778,
         270.87622],
        [      nan,       nan,       nan, ..., 271.8478 , 271.35623,
         270.78433]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 270.06155, 269.17004,
         268.7786 ],
        [      nan,       nan,       nan, ..., 269.6548 , 269.1635 ,
         268.67227],
        [      nan,       nan,       nan, ..., 269.63492, 269.057  ,
         268.65283]],

       ...,

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 277.1879 , 276.33917,
         276.03476],
        [      nan,       nan,       nan, ..., 276.86758, 276.36328,
         275.859  ],
        [      nan,       nan,       nan, ..., 276.79156, 276.2874 ,
         275.82758]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 277.70404, 277.39084,
         276.97433],
        [      nan,       nan,       nan, ..., 277.34024, 276.8421 ,
         276.762  ],
        [      nan,       nan,       nan, ..., 277.26825, 276.48682,
         276.36444]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 281.16882, 280.37064,
         280.07254],
        [      nan,       nan,       nan, ..., 280.88696, 280.38916,
         279.8914 ],
        [      nan,       nan,       nan, ..., 280.80515, 280.2077 ,
         279.81027]]], dtype=float32)
Coordinates:
  * lat      (lat) float64 49.4 49.36 49.32 49.28 ... 45.15 45.11 45.07 45.03
  * time     (time) datetime64[ns] 1990-01-01 1990-01-02 ... 1991-12-31
  * lon      (lon) float64 -124.8 -124.7 -124.7 -124.6 ... -120.1 -120.1 -120.0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 730</li><li><span class='xr-has-index'>lat</span>: 106</li><li><span class='xr-has-index'>lon</span>: 115</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-db0fbd2a-0328-4853-887e-e5d6d2df130e' class='xr-array-in' type='checkbox' ><label for='section-db0fbd2a-0328-4853-887e-e5d6d2df130e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan nan nan nan ... 280.30255 280.80515 280.2077 279.81027</span></div><pre class='xr-array-data'>array([[[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 272.9068 , 272.03818,
         271.74667],
        [      nan,       nan,       nan, ..., 272.58118, 271.9899 ,
         271.59863],
        [      nan,       nan,       nan, ..., 272.38995, 271.89896,
         271.48502]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 272.2721 , 271.3799 ,
         271.10745],
        [      nan,       nan,       nan, ..., 271.8796 , 271.28778,
         270.87622],
        [      nan,       nan,       nan, ..., 271.8478 , 271.35623,
         270.78433]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 270.06155, 269.17004,
         268.7786 ],
        [      nan,       nan,       nan, ..., 269.6548 , 269.1635 ,
         268.67227],
        [      nan,       nan,       nan, ..., 269.63492, 269.057  ,
         268.65283]],

       ...,

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 277.1879 , 276.33917,
         276.03476],
        [      nan,       nan,       nan, ..., 276.86758, 276.36328,
         275.859  ],
        [      nan,       nan,       nan, ..., 276.79156, 276.2874 ,
         275.82758]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 277.70404, 277.39084,
         276.97433],
        [      nan,       nan,       nan, ..., 277.34024, 276.8421 ,
         276.762  ],
        [      nan,       nan,       nan, ..., 277.26825, 276.48682,
         276.36444]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ..., 281.16882, 280.37064,
         280.07254],
        [      nan,       nan,       nan, ..., 280.88696, 280.38916,
         279.8914 ],
        [      nan,       nan,       nan, ..., 280.80515, 280.2077 ,
         279.81027]]], dtype=float32)</pre></div></li><li class='xr-section-item'><input id='section-d6517db1-9b5a-4653-bedc-74e286dabbce' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d6517db1-9b5a-4653-bedc-74e286dabbce' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>49.4 49.36 49.32 ... 45.07 45.03</div><input id='attrs-f0e94deb-8d80-4dc7-b606-d8d0813ed58e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f0e94deb-8d80-4dc7-b606-d8d0813ed58e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-640f00dc-6edf-4ea3-a822-5610bbb3c685' class='xr-var-data-in' type='checkbox'><label for='data-640f00dc-6edf-4ea3-a822-5610bbb3c685' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([49.4     , 49.358333, 49.316667, 49.275   , 49.233333, 49.191667,
       49.15    , 49.108333, 49.066667, 49.025   , 48.983333, 48.941667,
       48.9     , 48.858333, 48.816667, 48.775   , 48.733333, 48.691667,
       48.65    , 48.608333, 48.566667, 48.525   , 48.483333, 48.441667,
       48.4     , 48.358333, 48.316667, 48.275   , 48.233333, 48.191667,
       48.15    , 48.108333, 48.066667, 48.025   , 47.983333, 47.941667,
       47.9     , 47.858333, 47.816667, 47.775   , 47.733333, 47.691667,
       47.65    , 47.608333, 47.566667, 47.525   , 47.483333, 47.441667,
       47.4     , 47.358333, 47.316667, 47.275   , 47.233333, 47.191667,
       47.15    , 47.108333, 47.066667, 47.025   , 46.983333, 46.941667,
       46.9     , 46.858333, 46.816667, 46.775   , 46.733333, 46.691667,
       46.65    , 46.608333, 46.566667, 46.525   , 46.483333, 46.441667,
       46.4     , 46.358333, 46.316667, 46.275   , 46.233333, 46.191667,
       46.15    , 46.108333, 46.066667, 46.025   , 45.983333, 45.941667,
       45.9     , 45.858333, 45.816667, 45.775   , 45.733333, 45.691667,
       45.65    , 45.608333, 45.566667, 45.525   , 45.483333, 45.441667,
       45.4     , 45.358333, 45.316667, 45.275   , 45.233333, 45.191667,
       45.15    , 45.108333, 45.066667, 45.025   ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1990-01-01 ... 1991-12-31</div><input id='attrs-01b5ab71-4714-405d-8a2c-c5d0c00163e8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-01b5ab71-4714-405d-8a2c-c5d0c00163e8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4bafe22b-cd26-4d22-a4e2-a8bf63daf250' class='xr-var-data-in' type='checkbox'><label for='data-4bafe22b-cd26-4d22-a4e2-a8bf63daf250' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([&#x27;1990-01-01T00:00:00.000000000&#x27;, &#x27;1990-01-02T00:00:00.000000000&#x27;,
       &#x27;1990-01-03T00:00:00.000000000&#x27;, ..., &#x27;1991-12-29T00:00:00.000000000&#x27;,
       &#x27;1991-12-30T00:00:00.000000000&#x27;, &#x27;1991-12-31T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-124.8 -124.7 ... -120.1 -120.0</div><input id='attrs-749569fa-3cc4-476b-ba23-fc7297f0cb7a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-749569fa-3cc4-476b-ba23-fc7297f0cb7a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2e45550b-bd0f-4bf1-bd30-72bb27813fdc' class='xr-var-data-in' type='checkbox'><label for='data-2e45550b-bd0f-4bf1-bd30-72bb27813fdc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-124.766667, -124.725   , -124.683333, -124.641667, -124.6     ,
       -124.558333, -124.516667, -124.475   , -124.433333, -124.391667,
       -124.35    , -124.308333, -124.266667, -124.225   , -124.183333,
       -124.141667, -124.1     , -124.058333, -124.016667, -123.975   ,
       -123.933333, -123.891667, -123.85    , -123.808333, -123.766667,
       -123.725   , -123.683333, -123.641667, -123.6     , -123.558333,
       -123.516667, -123.475   , -123.433333, -123.391667, -123.35    ,
       -123.308333, -123.266667, -123.225   , -123.183333, -123.141667,
       -123.1     , -123.058333, -123.016667, -122.975   , -122.933333,
       -122.891667, -122.85    , -122.808333, -122.766667, -122.725   ,
       -122.683333, -122.641667, -122.6     , -122.558333, -122.516667,
       -122.475   , -122.433333, -122.391667, -122.35    , -122.308333,
       -122.266667, -122.225   , -122.183333, -122.141667, -122.1     ,
       -122.058333, -122.016667, -121.975   , -121.933333, -121.891667,
       -121.85    , -121.808333, -121.766667, -121.725   , -121.683333,
       -121.641667, -121.6     , -121.558333, -121.516667, -121.475   ,
       -121.433333, -121.391667, -121.35    , -121.308333, -121.266667,
       -121.225   , -121.183333, -121.141667, -121.1     , -121.058333,
       -121.016667, -120.975   , -120.933333, -120.891667, -120.85    ,
       -120.808333, -120.766667, -120.725   , -120.683333, -120.641667,
       -120.6     , -120.558333, -120.516667, -120.475   , -120.433333,
       -120.391667, -120.35    , -120.308333, -120.266667, -120.225   ,
       -120.183333, -120.141667, -120.1     , -120.058333, -120.016667])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-d9b2d023-82ab-4d04-9813-54561ef55eef' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d9b2d023-82ab-4d04-9813-54561ef55eef' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fbffcad1be0&gt;
</pre></div>
</div>
<img alt="../../_images/2020ECAHM-scikit-downscale_43_2.png" src="../../_images/2020ECAHM-scikit-downscale_43_2.png" />
</div>
</div>
</div>
<div class="section" id="spatial-models">
<h3>2.2 Spatial Models<a class="headerlink" href="#spatial-models" title="Permalink to this headline">¶</a></h3>
<p>Spatial models is a second class of downscaling methods that use information from the full study domain to form relationships between observations and ESM data. Scikit-downscale implements these models as as SpatialDownscaler. Beyond providing fit and predict methods that accept Xarray objects, the internal layout of these methods is intentionally unspecified. We are currently working on wrapping a few popular spatial downscaling models such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.climatologylab.org/maca.html">MACA: Multivariate Adaptive Constructed Analogs</a>, Abatzoglou and Brown (2012)</p></li>
<li><p><a class="reference external" href="http://loca.ucsd.edu/">LOCA: Localized Constructed Analogs</a>, Pierce, Cayan, and Thrasher (2014)</p></li>
</ul>
</div>
</div>
<div class="section" id="discussion">
<h2>3. Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="benchmark-applications">
<h3>3.1 Benchmark Applications<a class="headerlink" href="#benchmark-applications" title="Permalink to this headline">¶</a></h3>
<p>Its likely that one of the reasons we haven’t seen strong consensus develop around particularl downscaling methodologies is the abscense of widely available benchamrk applications to test methods against eachother. While Scikit-downscale will not solve this problem on its own, we hope the ability to implemnt downscaling applications within a common framework will enable a more robust benchmarking inititive that previously possible.</p>
</div>
<div class="section" id="call-for-participation">
<h3>3.2 Call for Participation<a class="headerlink" href="#call-for-participation" title="Permalink to this headline">¶</a></h3>
<p>The Scikit-downscale effort is just getting started. With the recent release of <a class="reference external" href="https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6">CMIP6</a>, we expect a surge of interest in downscaled climate data. There are clear opportunities for involvement from climate impacts practicioneers, computer scientists with an interest in machine learning for climate applications, and climate scientists alike. Please reach out if you are interested in participating in any way.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Abatzoglou, J. T. (2013), Development of gridded surface meteorological data for ecological applications and modelling. Int. J. Climatol., 33: 121–131.</p></li>
<li><p>Abatzoglou J.T. and Brown T.J. A comparison of statistical downscaling methods suited for wildfire applications, International Journal of Climatology (2012), 32, 772-780</p></li>
<li><p>Gutmann, E., Pruitt, T., Clark, M. P., Brekke, L., Arnold, J. R., Raff, D. A., and Rasmussen, R. M. ( 2014), An intercomparison of statistical downscaling methods used for water resource assessments in the United States, Water Resour. Res., 50, 7167– 7186, doi:10.1002/2014WR015559.</p></li>
<li><p>Gutmann, E., J. Hamman, M. Clark, T. Eidhammer, A. Wood, J. Arnold, K. Nowak (in prep), Evaluating the effect of statistical downscaling methodological choices in a common framework. To be submitted to JGR-Atomspheres.</p></li>
<li><p>Hamlet, A.F., Salathé, E.P., and Carrasco, P., 2010. Statistical downscaling techniques for global climate model simulations of temperature and precipitation with application to water resources planning studies. A report prepared by the Climate Impact Group for Columbia Basin Climate Change Scenario Project, University of Washington, Seattle, WA.
<a class="reference external" href="http://www.hydro.washington.edu/2860/products/sites/r7climate/study_report/CBCCSP_chap4_gcm_draft_20100111.pdf">http://www.hydro.washington.edu/2860/products/sites/r7climate/study_report/CBCCSP_chap4_gcm_draft_20100111.pdf</a></p></li>
<li><p>Lanzante JR, KW Dixon, MJ Nath, CE Whitlock, and D Adams-Smith (2018): Some Pitfalls in Statistical Downscaling of Future Climate. Bulletin of the American Meteorological Society. DOI: 0.1175/BAMS-D-17-0046.1.</p></li>
<li><p>Livneh B., E.A. Rosenberg, C. Lin, B. Nijssen, V. Mishra, K.M. Andreadis, E.P. Maurer, and D.P. Lettenmaier, 2013: A Long-Term Hydrologically Based Dataset of Land Surface Fluxes and States for the Conterminous United States: Update and Extensions, Journal of Climate, 26, 9384–9392.</p></li>
<li><p>Pierce, D. W., D. R. Cayan, and B. L. Thrasher, 2014: Statistical downscaling using Localized Constructed Analogs (LOCA). Journal of Hydrometeorology, volume 15, page 2558-2585</p></li>
<li><p>Stoner, A., K. Hayhoe, and X. Yang (2012), An asynchronous regional regression model for statistical downscaling of daily climate variables, Int. J. Climatol., 33, 2473–2494, doi:10.1002/joc.3603.</p></li>
<li><p>Wood, A., L. Leung, V. Sridhar, and D. Lettenmaier (2004), Hydrologic implications of dynamical and statistical approaches to downscaling climate model outputs, Clim. Change, 62, 189–216.</p></li>
</ol>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This notebook is licensed under <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>. Scikit-downscale is licensed under <a class="reference external" href="https://github.com/jhamman/scikit-downscale/blob/master/LICENSE">Apache License 2.0</a>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-notebook-py"
        },
        kernelOptions: {
            kernelName: "conda-env-notebook-py",
            path: "./ec2020/ec20_hamman_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-notebook-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../ec20_busecke_etal/busecke_abernathey_earthcube2020.html" title="previous page">CMIP6 without the interpolation: Grid-native analysis with Pangeo in the cloud</a>
    <a class='right-next' id="next-link" href="../ec20_havlin_etal/notebook/ec20_havlin_etal.html" title="next page">3D volume rendering of geophysical data using the yt platform</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>